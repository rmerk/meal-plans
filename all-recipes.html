<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#F06C6C">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Recipe Library - Browse All Recipes</title>
    <link rel="manifest" href="/manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=DM+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="mobile-utils.js"></script>
    <link rel="stylesheet" href="/dark-mode.css">
    <link rel="stylesheet" href="/landscape.css">
    <style>
        body {
            font-family: 'DM Sans', sans-serif;
        }

        /* Atomic Age Sunset Color Palette */
        :root {
            --coral: #F06C6C;
            --coral-dark: #D95555;
            --sage: #87AB8F;
            --sage-light: #A4C4A7;
            --butter: #F4D35E;
            --butter-light: #FFE66D;
            --taupe: #C9B5A0;
            --warm-brown: #8B6F47;
            --warm-cream: #FFF8F0;
            --soft-peach: #FFE5D9;
            --charcoal: #2D3748;
        }

        .bg-coral { background-color: var(--coral); }
        .bg-sage { background-color: var(--sage); }
        .bg-butter { background-color: var(--butter); }
        .text-coral { color: var(--coral); }
        .text-sage { color: var(--sage); }
        .text-butter { color: var(--butter); }
        .border-coral { border-color: var(--coral); }

        /* Mid-Century Typography */
        h1, h2, h3 {
            font-family: 'Space Grotesk', sans-serif;
            letter-spacing: -0.02em;
        }

        /* Mobile optimizations */
        * {
            -webkit-tap-highlight-color: transparent;
        }

        button, a, input, label {
            touch-action: manipulation;
        }

        /* Safe area insets for iPhone notch */
        nav.sticky {
            padding-top: env(safe-area-inset-top);
        }

        .fixed.bottom-0 {
            padding-bottom: calc(0.75rem + env(safe-area-inset-bottom));
        }

        /* Animations for toast/notifications */
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fade-out {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        @keyframes slide-up {
            from { opacity: 0; transform: translateY(100px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-fade-in { animation: fade-in 0.3s ease-out; }
        .animate-fade-out { animation: fade-out 0.3s ease-out; }
        .animate-slide-up { animation: slide-up 0.4s ease-out; }

        /* Atomic Age Hero Section */
        .hero-gradient {
            background: linear-gradient(165deg, var(--coral) 0%, #FF8787 50%, var(--butter) 100%);
            position: relative;
        }

        /* Geometric Shapes */
        .geometric-circle {
            border-radius: 50%;
            border: 3px solid var(--sage);
            background: transparent;
        }

        .geometric-square {
            border: 3px solid var(--butter);
            background: transparent;
            transform: rotate(45deg);
        }

        /* Floating animation */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .float-animation {
            animation: float 3s ease-in-out infinite;
        }

        /* Atomic Age Search Bar */
        .search-bar {
            transition: all 0.3s ease;
            border: 3px solid var(--charcoal);
            font-family: 'DM Sans', sans-serif;
        }

        .search-bar:focus {
            box-shadow: 6px 6px 0 0 var(--sage);
            border-color: var(--coral);
            outline: none;
        }

        /* Recipe Cards */
        .recipe-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            border: 3px solid var(--charcoal);
            box-shadow: 6px 6px 0 0 rgba(135, 171, 143, 0.25);
        }

        .recipe-card:hover {
            transform: translate(-2px, -2px);
            box-shadow: 8px 8px 0 0 rgba(135, 171, 143, 0.35);
        }

        /* Plan Section Cards */
        .recipe-plan-section {
            border: 3px solid var(--charcoal);
            box-shadow: 8px 8px 0 0 var(--sage);
            position: relative;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }
    </style>
    <script src="meals/plans.js"></script>
</head>
<body class="min-h-screen antialiased" style="background: linear-gradient(135deg, var(--warm-cream) 0%, var(--soft-peach) 50%, #FFF4E6 100%);">

    <!-- Hero Section -->
    <header class="hero-gradient relative overflow-hidden">
        <!-- Mid-Century Geometric Decorations -->
        <div class="absolute inset-0 opacity-20">
            <!-- Geometric circles -->
            <div class="geometric-circle absolute" style="top: 15%; right: 10%; width: 100px; height: 100px; animation: float 7s ease-in-out infinite;"></div>
            <div class="geometric-circle absolute" style="bottom: 20%; left: 15%; width: 70px; height: 70px; animation: float 9s ease-in-out infinite; animation-delay: 2s;"></div>

            <!-- Geometric squares -->
            <div class="geometric-square absolute" style="top: 35%; left: 8%; width: 50px; height: 50px; animation: float 5s ease-in-out infinite; animation-delay: 1.5s;"></div>
            <div class="geometric-square absolute" style="bottom: 25%; right: 20%; width: 80px; height: 80px; animation: float 10s ease-in-out infinite; animation-delay: 0.8s;"></div>
        </div>

        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-16 sm:py-20 relative z-10">
            <div class="text-center">
                <!-- Atomic Age Icon Badge -->
                <div class="inline-block mb-6">
                    <div class="relative">
                        <div class="w-24 h-24 flex items-center justify-center text-5xl" style="background: var(--sage); border: 4px solid var(--charcoal); border-radius: 50%; box-shadow: 8px 8px 0 0 rgba(255, 255, 255, 0.3);">
                            üìñ
                        </div>
                        <div class="absolute -top-2 -right-2 w-8 h-8 rounded-full" style="background: var(--butter); border: 3px solid var(--charcoal);"></div>
                    </div>
                </div>
                <h1 class="text-5xl sm:text-6xl font-bold text-white tracking-tight mb-6 drop-shadow-lg" style="text-shadow: 3px 3px 0 rgba(0,0,0,0.2);">
                    Recipe Library
                </h1>
                <p class="text-xl sm:text-2xl text-white/95 max-w-3xl mx-auto mb-8 font-normal leading-relaxed">
                    Explore our complete collection of delicious, high-protein recipes
                </p>
                <a href="index.html" class="inline-flex items-center px-6 py-3 text-white font-bold transition-all duration-200 uppercase tracking-wide text-sm" style="background: var(--sage); border: 3px solid var(--charcoal); box-shadow: 4px 4px 0 0 var(--butter); font-family: 'Space Grotesk', sans-serif;">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                    Back to Dashboard
                </a>
            </div>
        </div>

        <!-- Geometric separator -->
        <div class="absolute bottom-0 left-0 right-0 h-8" style="background: repeating-linear-gradient(90deg, var(--warm-cream) 0px, var(--warm-cream) 40px, var(--sage) 40px, var(--sage) 43px, var(--warm-cream) 43px, var(--warm-cream) 83px, var(--butter) 83px, var(--butter) 86px);"></div>
    </header>

    <!-- Main Content -->
    <main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-12">

        <!-- Search Bar -->
        <div class="mb-12">
            <div class="bg-white p-6" style="border: 3px solid var(--charcoal); box-shadow: 8px 8px 0 0 var(--butter); border-left: 12px solid var(--coral);">
                <div class="flex items-center mb-4">
                    <div class="w-12 h-12 flex items-center justify-center text-2xl" style="background: var(--coral); border: 3px solid var(--charcoal); box-shadow: 4px 4px 0 0 var(--sage);">
                        üîç
                    </div>
                    <h2 class="ml-4 text-2xl font-bold" style="color: var(--charcoal); font-family: 'Space Grotesk', sans-serif;">Find Your Perfect Recipe</h2>
                </div>
                <div class="relative">
                    <input
                        type="text"
                        id="search"
                        placeholder="Search by name, protein type, cuisine, or meal..."
                        class="search-bar w-full px-6 py-4 bg-white text-slate-800 placeholder-slate-500 text-lg"
                        style="box-shadow: 6px 6px 0 0 rgba(135, 171, 143, 0.3);"
                        oninput="filterRecipes()"
                        list="recipe-suggestions"
                        autocomplete="off"
                    >
                    <datalist id="recipe-suggestions">
                        <!-- Dynamically populated by JavaScript -->
                    </datalist>
                    <!-- Voice Search Button -->
                    <button
                        onclick="startRecipeVoiceSearch()"
                        id="voice-search-btn"
                        class="absolute right-2 top-2 w-12 h-12 flex items-center justify-center text-white transition-all duration-200"
                        style="background: var(--coral); border: 3px solid var(--charcoal); box-shadow: 3px 3px 0 0 var(--butter);"
                        aria-label="Voice search"
                        title="Voice search (click and speak)"
                    >
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/>
                        </svg>
                    </button>
                </div>
                <p class="text-sm mt-4" style="color: var(--charcoal);">
                    <span class="font-semibold px-2 py-1 text-xs" style="background: var(--butter); color: var(--charcoal); border: 2px solid var(--charcoal); font-family: 'Space Grotesk', sans-serif;">üí° TRY</span>
                    <span class="ml-2 text-slate-600">"chicken", "Korean", "breakfast", "tofu"</span>
                </p>
            </div>
        </div>

        <!-- Recipe Directory -->
        <div id="recipe-directory" class="space-y-10">
            <!-- Dynamically generated recipe cards will go here -->
        </div>

        <!-- No Results Message -->
        <div id="no-results" class="hidden text-center py-16">
            <div class="bg-white p-12 max-w-md mx-auto" style="border: 3px solid var(--charcoal); box-shadow: 8px 8px 0 0 var(--sage);">
                <div class="w-20 h-20 mx-auto mb-6 flex items-center justify-center" style="border-radius: 50%; background: var(--soft-peach); border: 3px solid var(--charcoal);">
                    <svg class="w-10 h-10" style="color: var(--coral);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <h3 class="text-2xl font-bold mb-3" style="color: var(--charcoal); font-family: 'Space Grotesk', sans-serif;">No recipes found</h3>
                <p class="text-slate-700">Try adjusting your search or browse all recipes below</p>
            </div>
        </div>

    </main>

    <footer class="text-center py-16 mt-24">
        <div class="max-w-6xl mx-auto px-4">
            <!-- Atomic Age Footer Decoration -->
            <div class="flex justify-center mb-6">
                <div class="w-20 h-20 flex items-center justify-center text-4xl" style="background: var(--sage); border: 3px solid var(--charcoal); border-radius: 50%; box-shadow: 6px 6px 0 0 var(--butter);">
                    üçΩÔ∏è
                </div>
            </div>
            <p class="text-slate-700 text-lg font-semibold mb-2" style="font-family: 'Space Grotesk', sans-serif;">
                Discover delicious recipes from your collection
            </p>
            <p class="text-slate-500 text-base">
                All recipes curated for your meal prep success
            </p>
            <!-- Geometric decoration -->
            <div class="mt-8 flex justify-center gap-4">
                <div class="w-3 h-3" style="background: var(--coral); border: 2px solid var(--charcoal);"></div>
                <div class="w-3 h-3 rounded-full" style="background: var(--sage); border: 2px solid var(--charcoal);"></div>
                <div class="w-3 h-3" style="background: var(--butter); border: 2px solid var(--charcoal); transform: rotate(45deg);"></div>
            </div>
        </div>
    </footer>

    <script>
        // Comprehensive recipe data extracted from meal plans
        const recipesByPlan = {
            "Week 1 Meals": [
                { name: "Gochugaru Beef & Broccoli Bowl", type: "Lunch", servings: 4, protein: "Ground Beef", cuisine: "Korean-inspired" },
                { name: "Vietnamese-Style Chicken Salad", type: "Lunch", servings: 3, protein: "Chicken Breast", cuisine: "Vietnamese" },
                { name: "Classic Beef & Broccoli Stir-Fry", type: "Dinner", servings: 4, protein: "Flank Steak", cuisine: "Chinese" },
                { name: "Pork & Soba Noodle Stir-Fry", type: "Dinner", servings: 3, protein: "Pork Loin", cuisine: "Japanese" }
            ],
            "Week 1 Breakfasts": [
                { name: "Kimchi Scramble", type: "Breakfast", servings: 1, protein: "Eggs", cuisine: "Korean-inspired" },
                { name: "Greek Yogurt Protein Bowl", type: "Breakfast", servings: 1, protein: "Greek Yogurt", cuisine: "Greek" },
                { name: "Savory Tofu Scramble", type: "Breakfast", servings: 1, protein: "Tofu", cuisine: "American" },
                { name: "Protein Smoothie", type: "Breakfast", servings: 1, protein: "Protein Powder", cuisine: "American" }
            ],
            "Week 2 Meals": [
                { name: "Spicy Turkey 'Bibimbap' Bowl", type: "Lunch", servings: 4, protein: "Ground Turkey", cuisine: "Korean" },
                { name: "Ginger-Garlic Ground Chicken", type: "Lunch", servings: 3, protein: "Ground Chicken", cuisine: "Asian-inspired" },
                { name: "Spicy-Sweet Crispy Tofu", type: "Dinner", servings: 4, protein: "Tofu", cuisine: "Asian Fusion" },
                { name: "Ground Pork & Green Bean", type: "Dinner", servings: 3, protein: "Ground Pork", cuisine: "Chinese" }
            ],
            "Week 2 Breakfasts": [
                { name: "Egg White & Veggie Scramble", type: "Breakfast", servings: 1, protein: "Egg Whites", cuisine: "American" },
                { name: "Cottage Cheese Protein Bowl", type: "Breakfast", servings: 1, protein: "Cottage Cheese", cuisine: "American" },
                { name: "High-Protein Oatmeal", type: "Breakfast", servings: 1, protein: "Protein Powder", cuisine: "American" },
                { name: "Breakfast Burrito Bowl", type: "Breakfast", servings: 1, protein: "Eggs", cuisine: "Mexican" }
            ],
            "Week 3 Meals": [
                { name: "Teriyaki Shrimp & Vegetables", type: "Lunch", servings: 4, protein: "Shrimp", cuisine: "Japanese" },
                { name: "Green Curry Chicken", type: "Lunch", servings: 3, protein: "Chicken Breast", cuisine: "Thai" },
                { name: "Mapo Tofu Beef Bowl", type: "Dinner", servings: 4, protein: "Ground Beef", cuisine: "Sichuan" },
                { name: "Mongolian Beef Stir-Fry", type: "Dinner", servings: 3, protein: "Flank Steak", cuisine: "Mongolian" }
            ],
            "Week 3 Breakfasts": [
                { name: "Savory Oats with Egg", type: "Breakfast", servings: 1, protein: "Eggs", cuisine: "Asian-inspired" },
                { name: "Berry Protein Smoothie", type: "Breakfast", servings: 1, protein: "Protein Powder", cuisine: "American" },
                { name: "Peanut Butter Protein Oats", type: "Breakfast", servings: 1, protein: "Protein Powder", cuisine: "American" },
                { name: "Spicy Breakfast Wrap", type: "Breakfast", servings: 1, protein: "Eggs", cuisine: "Mexican" }
            ]
        };

        // Emoji mapping for recipe types
        const recipeEmojis = {
            'breakfast': 'üç≥',
            'lunch': 'üç±',
            'dinner': 'üçú'
        };

        // Color palette for plan sections
        const planColors = [
            { bg: '#F06C6C', accent: '#87AB8F', shadow: 'rgba(135, 171, 143, 0.25)', emoji: 'üçΩÔ∏è' },
            { bg: '#F4D35E', accent: '#F06C6C', shadow: 'rgba(240, 108, 108, 0.25)', emoji: 'üç≥' },
            { bg: '#FF8787', accent: '#87AB8F', shadow: 'rgba(135, 171, 143, 0.25)', emoji: 'ü•ó' },
            { bg: '#87AB8F', accent: '#F4D35E', shadow: 'rgba(244, 211, 94, 0.25)', emoji: 'ü•ò' },
            { bg: '#C9B5A0', accent: '#F06C6C', shadow: 'rgba(240, 108, 108, 0.25)', emoji: 'üç≤' },
            { bg: '#D95555', accent: '#F4D35E', shadow: 'rgba(244, 211, 94, 0.25)', emoji: 'üå∂Ô∏è' }
        ];

        // Generate recipe cards on page load
        function generateRecipeCards() {
            const directory = document.getElementById('recipe-directory');
            directory.innerHTML = '';

            Object.entries(recipesByPlan).forEach(([planName, recipes], index) => {
                const planSection = document.createElement('div');
                planSection.className = 'recipe-plan-section bg-white p-8 fade-in';
                planSection.style.animationDelay = `${index * 0.1}s`;
                planSection.dataset.plan = planName.toLowerCase();

                const colors = planColors[index % planColors.length];

                const planHeader = document.createElement('div');
                planHeader.className = 'mb-6 pb-6';
                planHeader.style.borderBottom = `3px solid ${colors.accent}`;
                planHeader.innerHTML = `
                    <div class="flex items-center justify-between flex-wrap gap-4">
                        <div class="flex items-center">
                            <div class="w-14 h-14 flex items-center justify-center text-3xl mr-4" style="background: ${colors.bg}; border: 3px solid #2D3748; box-shadow: 4px 4px 0 0 ${colors.accent};">
                                ${planName.includes('Breakfast') ? 'üç≥' : 'üçΩÔ∏è'}
                            </div>
                            <div>
                                <h2 class="text-2xl sm:text-3xl font-bold mb-1" style="color: #2D3748; font-family: 'Space Grotesk', sans-serif;">
                                    ${planName}
                                </h2>
                                <p class="text-slate-600 font-medium">${recipes.length} delicious recipes in this plan</p>
                            </div>
                        </div>
                        <a href="meals/${getPlanFile(planName)}" class="inline-flex items-center px-6 py-3 text-white font-bold transition-all duration-200 uppercase tracking-wide text-sm" style="background: ${colors.accent}; border: 3px solid #2D3748; box-shadow: 4px 4px 0 0 ${colors.bg}; font-family: 'Space Grotesk', sans-serif;">
                            <span>View Full Plan ‚Üí</span>
                        </a>
                    </div>
                `;

                const recipeGrid = document.createElement('div');
                recipeGrid.className = 'grid md:grid-cols-2 gap-6 mt-6';

                recipes.forEach(recipe => {
                    const recipeCard = document.createElement('div');
                    recipeCard.className = 'recipe-card bg-white p-5';
                    recipeCard.dataset.recipeName = recipe.name.toLowerCase();
                    recipeCard.dataset.protein = recipe.protein.toLowerCase();
                    recipeCard.dataset.cuisine = recipe.cuisine.toLowerCase();

                    const typeEmoji = recipeEmojis[recipe.type.toLowerCase()] || 'üçΩÔ∏è';

                    recipeCard.innerHTML = `
                        <div class="flex items-start mb-4">
                            <div class="flex-shrink-0 w-12 h-12 flex items-center justify-center text-2xl mr-3" style="background: ${colors.bg}; border: 3px solid #2D3748; box-shadow: 3px 3px 0 0 ${colors.accent};">
                                ${typeEmoji}
                            </div>
                            <div class="flex-1">
                                <h3 class="font-bold text-lg leading-tight" style="color: #2D3748; font-family: 'Space Grotesk', sans-serif;">${recipe.name}</h3>
                            </div>
                        </div>
                        <div class="space-y-2.5 text-sm">
                            <div class="flex items-center">
                                <span class="w-7 h-7 flex items-center justify-center mr-2" style="background: ${colors.accent}; border: 2px solid #2D3748;">
                                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </span>
                                <span class="font-bold text-slate-700 w-20" style="font-family: 'Space Grotesk', sans-serif;">TYPE:</span>
                                <span class="text-slate-600">${recipe.type}</span>
                            </div>
                            <div class="flex items-center">
                                <span class="w-7 h-7 flex items-center justify-center mr-2" style="background: ${colors.accent}; border: 2px solid #2D3748;">
                                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z"></path>
                                    </svg>
                                </span>
                                <span class="font-bold text-slate-700 w-20" style="font-family: 'Space Grotesk', sans-serif;">PROTEIN:</span>
                                <span class="text-slate-600">${recipe.protein}</span>
                            </div>
                            <div class="flex items-center">
                                <span class="w-7 h-7 flex items-center justify-center mr-2" style="background: ${colors.accent}; border: 2px solid #2D3748;">
                                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                    </svg>
                                </span>
                                <span class="font-bold text-slate-700 w-20" style="font-family: 'Space Grotesk', sans-serif;">SERVINGS:</span>
                                <span class="text-slate-600">${recipe.servings}</span>
                            </div>
                            <div class="flex items-center">
                                <span class="w-7 h-7 flex items-center justify-center mr-2" style="background: ${colors.accent}; border: 2px solid #2D3748;">
                                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.055 11H5a2 2 0 012 2v1a2 2 0 002 2 2 2 0 012 2v2.945M8 3.935V5.5A2.5 2.5 0 0010.5 8h.5a2 2 0 012 2 2 2 0 104 0 2 2 0 012-2h1.064M15 20.488V18a2 2 0 012-2h3.064M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                </span>
                                <span class="font-bold text-slate-700 w-20" style="font-family: 'Space Grotesk', sans-serif;">CUISINE:</span>
                                <span class="text-slate-600">${recipe.cuisine}</span>
                            </div>
                        </div>
                    `;

                    recipeGrid.appendChild(recipeCard);
                });

                planSection.appendChild(planHeader);
                planSection.appendChild(recipeGrid);
                directory.appendChild(planSection);
            });
        }

        // Get plan filename from plan name
        function getPlanFile(planName) {
            const plan = mealPlans.find(p => p.title === planName);
            return plan ? plan.file : '#';
        }

        // Voice search for recipes
        function startRecipeVoiceSearch() {
            if (window.startVoiceSearch) {
                const searchInput = document.getElementById('search');
                const voiceBtn = document.getElementById('voice-search-btn');

                // Add listening state
                voiceBtn.classList.add('animate-pulse');
                voiceBtn.style.background = '#D95555';
                voiceBtn.title = 'Listening...';

                startVoiceSearch((transcript) => {
                    // Set the search input with the transcript
                    searchInput.value = transcript;
                    filterRecipes();

                    // Show success feedback
                    if (window.showToast) {
                        showToast(`üé§ Searching for "${transcript}"`);
                    }

                    // Remove listening state
                    voiceBtn.classList.remove('animate-pulse');
                    voiceBtn.style.background = '#F06C6C';
                    voiceBtn.title = 'Voice search (click and speak)';
                });

                // Handle errors by removing listening state
                setTimeout(() => {
                    voiceBtn.classList.remove('animate-pulse');
                    voiceBtn.style.background = '#F06C6C';
                    voiceBtn.title = 'Voice search (click and speak)';
                }, 10000); // 10 second timeout
            } else {
                alert('Voice search is not supported in this browser. Please try Chrome or Safari.');
            }
        }

        // Filter recipes based on search
        function filterRecipes() {
            const searchTerm = document.getElementById('search').value.toLowerCase();
            const recipeCards = document.querySelectorAll('.recipe-card');
            const planSections = document.querySelectorAll('.recipe-plan-section');
            let visibleCount = 0;

            planSections.forEach(section => {
                const cards = section.querySelectorAll('.recipe-card');
                let sectionHasVisible = false;

                cards.forEach(card => {
                    const recipeName = card.dataset.recipeName;
                    const protein = card.dataset.protein;
                    const cuisine = card.dataset.cuisine;

                    const matches = recipeName.includes(searchTerm) ||
                                  protein.includes(searchTerm) ||
                                  cuisine.includes(searchTerm);

                    if (matches) {
                        card.classList.remove('hidden');
                        sectionHasVisible = true;
                        visibleCount++;
                    } else {
                        card.classList.add('hidden');
                    }
                });

                if (sectionHasVisible) {
                    section.classList.remove('hidden');
                } else {
                    section.classList.add('hidden');
                }
            });

            // Show/hide no results message
            const noResults = document.getElementById('no-results');
            if (visibleCount === 0) {
                noResults.classList.remove('hidden');
            } else {
                noResults.classList.add('hidden');
            }
        }

        // Populate autocomplete suggestions
        function populateAutocompleteSuggestions() {
            const datalist = document.getElementById('recipe-suggestions');
            const suggestions = new Set();

            // Add all recipe names, proteins, and cuisines
            Object.values(recipesByPlan).forEach(recipes => {
                recipes.forEach(recipe => {
                    suggestions.add(recipe.name);
                    if (recipe.protein) suggestions.add(recipe.protein);
                    if (recipe.cuisine) suggestions.add(recipe.cuisine);
                });
            });

            // Populate datalist
            suggestions.forEach(suggestion => {
                const option = document.createElement('option');
                option.value = suggestion;
                datalist.appendChild(option);
            });
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            generateRecipeCards();
            populateAutocompleteSuggestions();

            // Initialize pull-to-refresh if available
            if (window.MobileUtils && window.MobileUtils.initPullToRefresh) {
                MobileUtils.initPullToRefresh(() => {
                    // Refresh recipe display
                    generateRecipeCards();
                    showToast('Recipes refreshed!');
                });
            }
        });
    </script>

<!-- Dark Mode Toggle Button - Include in all pages -->
<button
    id="dark-mode-toggle"
    onclick="toggleDarkMode()"
    class="fixed top-4 right-4 z-[100] w-12 h-12 rounded-full bg-white/90 dark:bg-slate-800/90 backdrop-blur-sm shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center group border-2 border-transparent hover:border-orange-400 no-print"
    aria-label="Toggle dark mode"
    title="Toggle dark mode"
>
    <!-- Sun Icon (visible in dark mode) -->
    <svg
        class="w-6 h-6 text-yellow-500 dark-mode-icon-sun hidden"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
    >
        <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
        />
    </svg>

    <!-- Moon Icon (visible in light mode) -->
    <svg
        class="w-6 h-6 text-slate-700 dark-mode-icon-moon"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
    >
        <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
        />
    </svg>
</button>

<style>
    /* Dark mode toggle icon visibility */
    [data-theme="dark"] .dark-mode-icon-moon {
        display: none;
    }

    [data-theme="dark"] .dark-mode-icon-sun {
        display: block;
    }

    [data-theme="light"] .dark-mode-icon-sun {
        display: none;
    }

    [data-theme="light"] .dark-mode-icon-moon {
        display: block;
    }

    /* Pulse animation on first load */
    @keyframes pulse-once {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
    }

    #dark-mode-toggle.first-load {
        animation: pulse-once 0.5s ease-out;
    }

    /* Rotate animation on click */
    @keyframes rotate-icon {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    #dark-mode-toggle.rotating svg {
        animation: rotate-icon 0.5s ease-out;
    }

    /* Position adjustment for mobile bottom nav */
    @media (max-width: 767px) {
        #dark-mode-toggle {
            top: auto;
            bottom: 5rem;
            right: 1rem;
        }
    }

    /* Print mode - hide toggle */
    @media print {
        #dark-mode-toggle {
            display: none !important;
        }
    }
</style>

<script>
    // Add rotating animation on click
    document.addEventListener('DOMContentLoaded', () => {
        const toggle = document.getElementById('dark-mode-toggle');
        if (toggle) {
            toggle.addEventListener('click', () => {
                toggle.classList.add('rotating');
                setTimeout(() => {
                    toggle.classList.remove('rotating');
                }, 500);
            });

            // Pulse animation on first load to draw attention
            if (!localStorage.getItem('dark-mode-toggle-seen')) {
                setTimeout(() => {
                    toggle.classList.add('first-load');
                    setTimeout(() => {
                        toggle.classList.remove('first-load');
                        localStorage.setItem('dark-mode-toggle-seen', 'true');
                    }, 500);
                }, 1000);
            }
        }
    });
</script>

</body>
</html>
