<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#d4735e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Analytics Dashboard - Meal Plans</title>
    <link rel="manifest" href="/manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="mobile-utils.js"></script>
    <link rel="stylesheet" href="/dark-mode.css">
    <link rel="stylesheet" href="/landscape.css">
    <style>
        body { font-family: 'Inter', sans-serif; }

        :root {
            --terracotta: #d4735e;
            --terracotta-dark: #b85c47;
            --warm-orange: #e88d67;
        }

        .bg-terracotta { background-color: var(--terracotta); }
        .text-terracotta { color: var(--terracotta); }

        .hero-gradient {
            background: linear-gradient(135deg, #d4735e 0%, #e88d67 50%, #ffa07a 100%);
        }

        .stat-card {
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.4s ease-out;
        }

        .chart-container {
            position: relative;
            height: 300px;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-orange-50 via-amber-50 to-rose-50 min-h-screen antialiased">

    <!-- Header -->
    <header class="hero-gradient shadow-xl relative overflow-hidden">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="text-center">
                <div class="inline-block mb-4">
                    <span class="text-5xl">üìä</span>
                </div>
                <h1 class="text-4xl sm:text-5xl font-extrabold text-white tracking-tight mb-3">
                    Analytics Dashboard
                </h1>
                <p class="text-xl text-white/95 max-w-2xl mx-auto mb-6 font-light">
                    Track your progress ‚Ä¢ Analyze nutrition ‚Ä¢ Celebrate milestones
                </p>
                <a href="index.html" class="inline-flex items-center px-6 py-3 bg-white/20 hover:bg-white/30 backdrop-blur-sm text-white font-semibold rounded-xl transition-all duration-200 border-2 border-white/40">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                    Back to Dashboard
                </a>
            </div>
        </div>

        <div class="absolute bottom-0 left-0 right-0">
            <svg viewBox="0 0 1440 80" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-full">
                <path d="M0 0L60 8C120 16 240 32 360 37.3C480 43 600 37 720 34.7C840 32 960 32 1080 37.3C1200 43 1320 53 1380 58.7L1440 64V80H1380C1320 80 1200 80 1080 80C960 80 840 80 720 80C600 80 480 80 360 80C240 80 120 80 60 80H0V0Z" fill="#fef7f5" fill-opacity="0.9"/>
            </svg>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">

        <!-- Summary Stats -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <div class="stat-card bg-white rounded-2xl p-6 shadow-lg border-2 border-emerald-100 fade-in">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-3xl">üî•</span>
                    <span class="text-xs font-semibold text-emerald-600 bg-emerald-50 px-3 py-1 rounded-full">This Week</span>
                </div>
                <div class="text-3xl font-bold text-slate-800" id="meals-cooked">0</div>
                <div class="text-sm text-slate-600">Meals Cooked</div>
            </div>

            <div class="stat-card bg-white rounded-2xl p-6 shadow-lg border-2 border-blue-100 fade-in" style="animation-delay: 0.1s">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-3xl">üìÖ</span>
                    <span class="text-xs font-semibold text-blue-600 bg-blue-50 px-3 py-1 rounded-full">Streak</span>
                </div>
                <div class="text-3xl font-bold text-slate-800" id="meal-streak">0</div>
                <div class="text-sm text-slate-600">Day Streak</div>
            </div>

            <div class="stat-card bg-white rounded-2xl p-6 shadow-lg border-2 border-purple-100 fade-in" style="animation-delay: 0.2s">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-3xl">‚≠ê</span>
                    <span class="text-xs font-semibold text-purple-600 bg-purple-50 px-3 py-1 rounded-full">Average</span>
                </div>
                <div class="text-3xl font-bold text-slate-800" id="avg-rating">0.0</div>
                <div class="text-sm text-slate-600">Meal Rating</div>
            </div>

            <div class="stat-card bg-white rounded-2xl p-6 shadow-lg border-2 border-orange-100 fade-in" style="animation-delay: 0.3s">
                <div class="flex items-center justify-between mb-2">
                    <span class="text-3xl">üí™</span>
                    <span class="text-xs font-semibold text-orange-600 bg-orange-50 px-3 py-1 rounded-full">Total</span>
                </div>
                <div class="text-3xl font-bold text-slate-800" id="total-protein">0g</div>
                <div class="text-sm text-slate-600">Protein (Week)</div>
            </div>
        </div>

        <!-- Charts Row -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- Meals Per Day Chart -->
            <div class="bg-white rounded-2xl p-6 shadow-lg border-2 border-orange-100 fade-in">
                <h3 class="text-xl font-bold text-slate-800 mb-4 flex items-center">
                    <span class="text-2xl mr-2">üìà</span>
                    Meals Per Day (Last 7 Days)
                </h3>
                <div class="chart-container">
                    <canvas id="meals-per-day-chart"></canvas>
                </div>
            </div>

            <!-- Macros Distribution Chart -->
            <div class="bg-white rounded-2xl p-6 shadow-lg border-2 border-orange-100 fade-in" style="animation-delay: 0.1s">
                <h3 class="text-xl font-bold text-slate-800 mb-4 flex items-center">
                    <span class="text-2xl mr-2">ü•ó</span>
                    Macro Distribution (Weekly Avg)
                </h3>
                <div class="chart-container">
                    <canvas id="macros-chart"></canvas>
                </div>
            </div>
        </div>

        <!-- Nutrition Trends -->
        <div class="bg-white rounded-2xl p-6 shadow-lg border-2 border-orange-100 mb-8 fade-in">
            <h3 class="text-xl font-bold text-slate-800 mb-4 flex items-center">
                <span class="text-2xl mr-2">üìâ</span>
                Nutrition Trends (Last 30 Days)
            </h3>
            <div class="chart-container" style="height: 400px;">
                <canvas id="nutrition-trends-chart"></canvas>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="bg-white rounded-2xl p-6 shadow-lg border-2 border-orange-100 fade-in">
            <h3 class="text-xl font-bold text-slate-800 mb-4 flex items-center">
                <span class="text-2xl mr-2">üìù</span>
                Recent Activity
            </h3>
            <div id="recent-activity" class="space-y-3">
                <!-- Activity items will be generated dynamically -->
            </div>
        </div>

    </main>

    <footer class="text-center text-slate-400 text-sm py-8 mt-12">
        <p>Analytics Dashboard ‚Ä¢ Tracking your nutrition journey</p>
    </footer>

    <script>
        const ANALYTICS_KEY = 'meal_prep_analytics';
        const CALENDAR_KEY = 'meal_plan_calendar';

        // Load analytics data
        function loadAnalytics() {
            const saved = localStorage.getItem(ANALYTICS_KEY);
            if (saved) return JSON.parse(saved);

            // Initialize with sample data for demonstration
            return {
                mealHistory: generateSampleMealHistory(),
                nutritionLog: generateSampleNutritionLog()
            };
        }

        // Save analytics data
        function saveAnalytics(data) {
            localStorage.setItem(ANALYTICS_KEY, JSON.stringify(data));
        }

        // Generate sample meal history for demonstration
        function generateSampleMealHistory() {
            const history = [];
            const today = new Date();

            for (let i = 0; i < 30; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);

                const mealsCount = Math.floor(Math.random() * 4); // 0-3 meals per day
                for (let j = 0; j < mealsCount; j++) {
                    history.push({
                        date: date.toISOString().split('T')[0],
                        mealName: ['Teriyaki Chicken', 'Beef & Broccoli', 'Greek Yogurt Bowl', 'Protein Oats', 'Salmon'][Math.floor(Math.random() * 5)],
                        rating: Math.floor(Math.random() * 3) + 3 // 3-5 stars
                    });
                }
            }

            return history.sort((a, b) => new Date(b.date) - new Date(a.date));
        }

        // Generate sample nutrition log
        function generateSampleNutritionLog() {
            const log = [];
            const today = new Date();

            for (let i = 0; i < 30; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);

                log.push({
                    date: date.toISOString().split('T')[0],
                    calories: Math.floor(Math.random() * 500) + 2000, // 2000-2500
                    protein: Math.floor(Math.random() * 50) + 150, // 150-200g
                    carbs: Math.floor(Math.random() * 100) + 200, // 200-300g
                    fats: Math.floor(Math.random() * 30) + 50 // 50-80g
                });
            }

            return log.sort((a, b) => new Date(b.date) - new Date(a.date));
        }

        // Calculate statistics
        function calculateStats() {
            const analytics = loadAnalytics();
            const today = new Date();
            const sevenDaysAgo = new Date(today);
            sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);

            // Meals cooked this week
            const mealsThisWeek = analytics.mealHistory.filter(m => {
                const mealDate = new Date(m.date);
                return mealDate >= sevenDaysAgo;
            }).length;

            // Calculate streak
            let streak = 0;
            const sortedHistory = [...analytics.mealHistory].sort((a, b) => new Date(b.date) - new Date(a.date));
            const uniqueDates = [...new Set(sortedHistory.map(m => m.date))];

            for (let i = 0; i < uniqueDates.length; i++) {
                const date = new Date(uniqueDates[i]);
                const expectedDate = new Date(today);
                expectedDate.setDate(expectedDate.getDate() - i);

                if (date.toISOString().split('T')[0] === expectedDate.toISOString().split('T')[0]) {
                    streak++;
                } else {
                    break;
                }
            }

            // Average rating
            const ratings = analytics.mealHistory.filter(m => m.rating).map(m => m.rating);
            const avgRating = ratings.length > 0 ? (ratings.reduce((a, b) => a + b, 0) / ratings.length).toFixed(1) : 0;

            // Total protein this week
            const proteinThisWeek = analytics.nutritionLog
                .filter(n => new Date(n.date) >= sevenDaysAgo)
                .reduce((sum, n) => sum + n.protein, 0);

            return {
                mealsThisWeek,
                streak,
                avgRating,
                proteinThisWeek
            };
        }

        // Update summary stats
        function updateSummaryStats() {
            const stats = calculateStats();

            document.getElementById('meals-cooked').textContent = stats.mealsThisWeek;
            document.getElementById('meal-streak').textContent = stats.streak;
            document.getElementById('avg-rating').textContent = stats.avgRating;
            document.getElementById('total-protein').textContent = `${stats.proteinThisWeek}g`;
        }

        // Create meals per day chart
        function createMealsPerDayChart() {
            const analytics = loadAnalytics();
            const today = new Date();
            const labels = [];
            const data = [];

            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];

                labels.push(date.toLocaleDateString('en-US', { weekday: 'short' }));
                const count = analytics.mealHistory.filter(m => m.date === dateStr).length;
                data.push(count);
            }

            const ctx = document.getElementById('meals-per-day-chart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Meals',
                        data: data,
                        backgroundColor: 'rgba(212, 115, 94, 0.8)',
                        borderColor: 'rgba(212, 115, 94, 1)',
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { stepSize: 1 }
                        }
                    }
                }
            });
        }

        // Create macros distribution chart
        function createMacrosChart() {
            const analytics = loadAnalytics();
            const today = new Date();
            const sevenDaysAgo = new Date(today);
            sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);

            const recentNutrition = analytics.nutritionLog.filter(n => new Date(n.date) >= sevenDaysAgo);

            const avgProtein = recentNutrition.reduce((sum, n) => sum + n.protein, 0) / recentNutrition.length;
            const avgCarbs = recentNutrition.reduce((sum, n) => sum + n.carbs, 0) / recentNutrition.length;
            const avgFats = recentNutrition.reduce((sum, n) => sum + n.fats, 0) / recentNutrition.length;

            const ctx = document.getElementById('macros-chart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Protein', 'Carbs', 'Fats'],
                    datasets: [{
                        data: [avgProtein * 4, avgCarbs * 4, avgFats * 9], // Convert to calories
                        backgroundColor: [
                            'rgba(239, 68, 68, 0.8)',
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(245, 158, 11, 0.8)'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { padding: 20, font: { size: 12 } }
                        }
                    }
                }
            });
        }

        // Create nutrition trends chart
        function createNutritionTrendsChart() {
            const analytics = loadAnalytics();
            const last30Days = analytics.nutritionLog.slice(0, 30).reverse();

            const labels = last30Days.map(n => {
                const date = new Date(n.date);
                return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            });

            const ctx = document.getElementById('nutrition-trends-chart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Protein (g)',
                            data: last30Days.map(n => n.protein),
                            borderColor: 'rgba(239, 68, 68, 1)',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'Carbs (g)',
                            data: last30Days.map(n => n.carbs),
                            borderColor: 'rgba(59, 130, 246, 1)',
                            backgroundColor: 'rgba(59, 130, 246, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'Fats (g)',
                            data: last30Days.map(n => n.fats),
                            borderColor: 'rgba(245, 158, 11, 1)',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: { padding: 20, font: { size: 12 } }
                        }
                    },
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }

        // Render recent activity
        function renderRecentActivity() {
            const analytics = loadAnalytics();
            const recent = analytics.mealHistory.slice(0, 10);
            const container = document.getElementById('recent-activity');

            if (recent.length === 0) {
                container.innerHTML = '<p class="text-slate-500 text-center py-8">No activity yet. Start cooking to see your history!</p>';
                return;
            }

            container.innerHTML = recent.map(meal => {
                const date = new Date(meal.date);
                const dateStr = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                const stars = '‚≠ê'.repeat(meal.rating || 0);

                return `
                    <div class="flex items-center justify-between p-4 bg-gradient-to-r from-slate-50 to-transparent rounded-lg border border-slate-200 hover:shadow-md transition">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-full bg-gradient-to-br from-terracotta to-warm-orange flex items-center justify-center text-white font-bold">
                                üçΩÔ∏è
                            </div>
                            <div>
                                <div class="font-semibold text-slate-800">${meal.mealName}</div>
                                <div class="text-sm text-slate-600">${dateStr}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-sm">${stars}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            updateSummaryStats();
            createMealsPerDayChart();
            createMacrosChart();
            createNutritionTrendsChart();
            renderRecentActivity();
        });
    </script>

    <!-- Dark Mode Toggle Button -->
    <button
        id="dark-mode-toggle"
        onclick="toggleDarkMode()"
        class="fixed top-4 right-4 z-[100] w-12 h-12 rounded-full bg-white/90 dark:bg-slate-800/90 backdrop-blur-sm shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center group border-2 border-transparent hover:border-orange-400"
        aria-label="Toggle dark mode"
        title="Toggle dark mode"
    >
        <svg
            class="w-6 h-6 text-yellow-500 dark-mode-icon-sun hidden"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
        >
            <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
            />
        </svg>
        <svg
            class="w-6 h-6 text-slate-700 dark-mode-icon-moon"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
        >
            <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
            />
        </svg>
    </button>

</body>
</html>
