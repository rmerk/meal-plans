<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#d4735e">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Recipe Scaler - Meal Plans</title>
    <link rel="manifest" href="/manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <script src="mobile-utils.js"></script>
    <link rel="stylesheet" href="/dark-mode.css">
    <link rel="stylesheet" href="/landscape.css">
    <style>
        body { font-family: 'Inter', sans-serif; }

        /* Custom terracotta/orange color palette */
        :root {
            --terracotta: #d4735e;
            --terracotta-dark: #b85c47;
            --warm-orange: #e88d67;
        }

        .bg-terracotta { background-color: var(--terracotta); }
        .text-terracotta { color: var(--terracotta); }
        .border-terracotta { border-color: var(--terracotta); }

        .hero-gradient {
            background: linear-gradient(135deg, #d4735e 0%, #e88d67 50%, #ffa07a 100%);
        }

        /* Mobile optimizations */
        * {
            -webkit-tap-highlight-color: transparent;
        }

        button, a, input, label {
            touch-action: manipulation;
        }

        /* Safe area insets for iPhone notch */
        nav.sticky {
            padding-top: env(safe-area-inset-top);
        }

        .fixed.bottom-0 {
            padding-bottom: calc(0.75rem + env(safe-area-inset-bottom));
        }

        /* Animations for toast/notifications */
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fade-out {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        @keyframes slide-up {
            from { opacity: 0; transform: translateY(100px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-fade-in { animation: fade-in 0.3s ease-out; }
        .animate-fade-out { animation: fade-out 0.3s ease-out; }
        .animate-slide-up { animation: slide-up 0.4s ease-out; }

        /* Smooth animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .fade-in {
            animation: fadeIn 0.4s ease-out;
        }

        .scale-in {
            animation: scaleIn 0.3s ease-out;
        }

        /* Scale button effects */
        .scale-button {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .scale-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .scale-button:hover::before {
            width: 200px;
            height: 200px;
        }

        .scale-button.active {
            transform: scale(1.05);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3), 0 4px 12px rgba(59, 130, 246, 0.4);
            animation: pulse 2s infinite;
        }

        .scale-button:hover:not(.active) {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        /* Input field effects */
        input:focus,
        textarea:focus {
            transform: scale(1.01);
            transition: all 0.2s ease;
        }

        /* Output styling */
        #scaled-output > div:hover {
            background: linear-gradient(to right, rgba(241, 245, 249, 0.8), rgba(226, 232, 240, 0.3)) !important;
            transform: translateX(4px);
            transition: all 0.2s ease;
        }

        /* Card hover effects */
        .card-hover {
            transition: all 0.3s ease;
        }

        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 20px -4px rgba(0, 0, 0, 0.1);
        }

        /* Button ripple effect */
        button {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px -2px rgba(0, 0, 0, 0.15);
        }

        button:active {
            transform: translateY(0);
        }

        /* Gradient borders */
        .gradient-border {
            position: relative;
            background: linear-gradient(white, white) padding-box,
                        linear-gradient(135deg, #667eea 0%, #764ba2 100%) border-box;
            border: 2px solid transparent;
        }
    </style>
    <script src="meals/plans.js"></script>
</head>
<body class="bg-gradient-to-br from-orange-50 via-amber-50 to-rose-50 min-h-screen antialiased">

    <!-- Header -->
    <header class="hero-gradient shadow-xl relative overflow-hidden">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="text-center">
                <div class="inline-block mb-4">
                    <span class="text-5xl">‚öñÔ∏è</span>
                </div>
                <h1 class="text-4xl sm:text-5xl font-extrabold text-white tracking-tight mb-3">
                    Recipe Scaler
                </h1>
                <p class="text-xl text-white/95 max-w-2xl mx-auto mb-6 font-light">
                    Scale recipes instantly ‚Ä¢ Adjust servings ‚Ä¢ Auto-calculate ingredients
                </p>
                <a href="index.html" class="inline-flex items-center px-6 py-3 bg-white/20 hover:bg-white/30 backdrop-blur-sm text-white font-semibold rounded-xl transition-all duration-200 border-2 border-white/40">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                    </svg>
                    Back to Dashboard
                </a>
            </div>
        </div>

        <!-- Wave separator -->
        <div class="absolute bottom-0 left-0 right-0">
            <svg viewBox="0 0 1440 80" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-full">
                <path d="M0 0L60 8C120 16 240 32 360 37.3C480 43 600 37 720 34.7C840 32 960 32 1080 37.3C1200 43 1320 53 1380 58.7L1440 64V80H1380C1320 80 1200 80 1080 80C960 80 840 80 720 80C600 80 480 80 360 80C240 80 120 80 60 80H0V0Z" fill="#fef7f5" fill-opacity="0.9"/>
            </svg>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-12">

        <!-- Instructions -->
        <div class="bg-gradient-to-r from-orange-50 to-rose-50 border-l-4 border-terracotta p-6 mb-10 rounded-2xl shadow-md">
            <div class="flex">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-purple-400" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                    </svg>
                </div>
                <div class="ml-3">
                    <p class="text-sm text-purple-700">
                        <strong>How it works:</strong> Enter any recipe with ingredients and quantities, select your desired scale (0.5x, 1x, 1.5x, 2x, or custom), and we'll automatically recalculate all ingredient amounts for you!
                    </p>
                </div>
            </div>
        </div>

        <div class="grid lg:grid-cols-2 gap-8">

            <!-- Left Column: Input -->
            <div class="bg-white shadow-lg rounded-xl p-6 card-hover fade-in">
                <h2 class="text-2xl font-bold mb-4 border-b border-slate-100 pb-2 bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent">üìù Original Recipe</h2>

                <div class="mb-4">
                    <label class="block text-sm font-bold text-slate-700 mb-2 flex items-center">
                        <span class="w-2 h-2 bg-purple-500 rounded-full mr-2"></span>
                        Recipe Name
                    </label>
                    <input
                        type="text"
                        id="recipe-name"
                        placeholder="e.g., Gochugaru Beef & Broccoli Bowl"
                        class="w-full px-4 py-3 border-2 border-slate-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition"
                    >
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-bold text-slate-700 mb-2 flex items-center">
                        <span class="w-2 h-2 bg-purple-500 rounded-full mr-2"></span>
                        Original Servings
                    </label>
                    <input
                        type="number"
                        id="original-servings"
                        value="4"
                        min="1"
                        class="w-full px-4 py-3 border-2 border-slate-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition"
                    >
                </div>

                <div class="mb-4">
                    <label class="block text-sm font-bold text-slate-700 mb-2 flex items-center">
                        <span class="w-2 h-2 bg-purple-500 rounded-full mr-2"></span>
                        Ingredients (one per line)
                    </label>
                    <textarea
                        id="ingredients-input"
                        rows="12"
                        placeholder="1.25 lbs ground beef&#10;8 cups broccoli florets&#10;4 cups cooked brown rice&#10;6 tbsp soy sauce&#10;4-8 tsp gochugaru&#10;4 tsp honey&#10;4 tsp sesame oil&#10;8 cloves garlic&#10;4 tsp ginger"
                        class="w-full px-4 py-3 border-2 border-slate-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-purple-500 font-mono text-sm transition"
                    ></textarea>
                    <p class="text-xs text-slate-500 mt-2 flex items-center">
                        <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Include quantities with units (cups, tbsp, lbs, etc.)
                    </p>
                </div>

                <button
                    onclick="loadSampleRecipe()"
                    class="w-full bg-slate-200 hover:bg-slate-300 text-slate-700 font-semibold py-2 px-4 rounded-lg transition"
                >
                    Load Sample Recipe
                </button>
            </div>

            <!-- Right Column: Scaled Output -->
            <div class="bg-white shadow-lg rounded-xl p-6 card-hover fade-in">
                <h2 class="text-2xl font-bold mb-4 border-b border-slate-100 pb-2 bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent">üéØ Scaled Recipe</h2>

                <!-- Scaling Controls -->
                <div class="mb-6">
                    <label class="block text-sm font-semibold text-slate-700 mb-3">Scale Factor</label>
                    <div class="grid grid-cols-5 gap-2 mb-3">
                        <button onclick="setScale(0.5)" class="scale-button bg-blue-100 hover:bg-blue-200 text-blue-800 font-bold py-2 rounded-lg transition">0.5x</button>
                        <button onclick="setScale(1)" class="scale-button bg-blue-500 text-white font-bold py-2 rounded-lg transition active">1x</button>
                        <button onclick="setScale(1.5)" class="scale-button bg-blue-100 hover:bg-blue-200 text-blue-800 font-bold py-2 rounded-lg transition">1.5x</button>
                        <button onclick="setScale(2)" class="scale-button bg-blue-100 hover:bg-blue-200 text-blue-800 font-bold py-2 rounded-lg transition">2x</button>
                        <button onclick="setScale(3)" class="scale-button bg-blue-100 hover:bg-blue-200 text-blue-800 font-bold py-2 rounded-lg transition">3x</button>
                    </div>
                    <div class="flex gap-2 items-center">
                        <!-- Stepper Controls -->
                        <button
                            onclick="decrementScale()"
                            class="w-12 h-12 flex items-center justify-center bg-slate-200 hover:bg-slate-300 text-slate-700 font-bold rounded-lg transition-all active:scale-95"
                            aria-label="Decrease scale"
                            title="Decrease by 0.25x"
                        >
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M20 12H4"/>
                            </svg>
                        </button>
                        <input
                            type="number"
                            id="custom-scale"
                            step="0.25"
                            min="0.1"
                            max="10"
                            placeholder="Custom"
                            inputmode="decimal"
                            class="flex-1 px-4 py-3 text-center text-lg font-bold border-2 border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        >
                        <button
                            onclick="incrementScale()"
                            class="w-12 h-12 flex items-center justify-center bg-emerald-500 hover:bg-emerald-600 text-white font-bold rounded-lg transition-all active:scale-95"
                            aria-label="Increase scale"
                            title="Increase by 0.25x"
                        >
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M12 4v16m8-8H4"/>
                            </svg>
                        </button>
                        <button
                            onclick="applyCustomScale()"
                            class="bg-purple-500 hover:bg-purple-600 text-white font-semibold px-6 py-2 rounded-lg transition"
                        >
                            Apply
                        </button>
                    </div>
                </div>

                <!-- Servings Info -->
                <div class="bg-gradient-to-r from-green-50 via-emerald-50 to-teal-50 border-2 border-green-200 rounded-xl p-5 mb-4 shadow-sm scale-in">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center">
                            <div class="bg-green-100 rounded-full p-3 mr-3">
                                <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                                </svg>
                            </div>
                            <div>
                                <div class="text-xs font-semibold text-slate-600 uppercase tracking-wide">New Servings</div>
                                <div id="new-servings" class="text-3xl font-bold bg-gradient-to-r from-green-600 to-emerald-600 bg-clip-text text-transparent">4</div>
                            </div>
                        </div>
                        <div class="text-right flex items-center">
                            <div class="mr-3">
                                <div class="text-xs font-semibold text-slate-600 uppercase tracking-wide">Scale Factor</div>
                                <div id="current-scale" class="text-3xl font-bold bg-gradient-to-r from-blue-600 to-cyan-600 bg-clip-text text-transparent">1.0x</div>
                            </div>
                            <div class="bg-blue-100 rounded-full p-3">
                                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Scaled Ingredients -->
                <div class="mb-4">
                    <label class="block text-sm font-bold text-slate-700 mb-2 flex items-center">
                        <span class="w-2 h-2 bg-blue-500 rounded-full mr-2"></span>
                        Scaled Ingredients
                    </label>
                    <div id="scaled-output" class="bg-gradient-to-br from-slate-50 to-slate-100 border-2 border-slate-200 rounded-xl p-4 min-h-[300px] font-mono text-sm shadow-inner">
                        <div class="text-slate-400 text-center py-12 flex flex-col items-center">
                            <svg class="w-12 h-12 mb-3 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                            </svg>
                            <span>Enter ingredients and select a scale factor</span>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex gap-2">
                    <button
                        onclick="copyScaledRecipe()"
                        class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg transition flex items-center justify-center gap-2"
                    >
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                        </svg>
                        Copy
                    </button>
                    <button
                        onclick="printRecipe()"
                        class="flex-1 bg-emerald-500 hover:bg-emerald-600 text-white font-semibold py-2 px-4 rounded-lg transition flex items-center justify-center gap-2"
                    >
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"></path>
                        </svg>
                        Print
                    </button>
                </div>
            </div>

        </div>

        <!-- Tips -->
        <div class="mt-8 bg-white shadow rounded-xl p-6">
            <h3 class="font-bold text-lg text-slate-800 mb-3">üí° Pro Tips</h3>
            <ul class="grid md:grid-cols-2 gap-3 text-sm text-slate-600">
                <li class="flex items-start">
                    <span class="w-2 h-2 bg-blue-400 rounded-full mr-2 mt-1.5"></span>
                    <span>Use standard abbreviations: tsp, tbsp, cup, lb, oz, g, kg</span>
                </li>
                <li class="flex items-start">
                    <span class="w-2 h-2 bg-blue-400 rounded-full mr-2 mt-1.5"></span>
                    <span>Fractions work too: 1/2 cup, 1/4 tsp, 3/4 lb</span>
                </li>
                <li class="flex items-start">
                    <span class="w-2 h-2 bg-blue-400 rounded-full mr-2 mt-1.5"></span>
                    <span>Scale up for meal prep or down for smaller portions</span>
                </li>
                <li class="flex items-start">
                    <span class="w-2 h-2 bg-blue-400 rounded-full mr-2 mt-1.5"></span>
                    <span>Seasonings may not need full scaling - adjust to taste</span>
                </li>
            </ul>
        </div>

    </main>

    <footer class="text-center text-slate-400 text-sm py-8 mt-12">
        <p>Recipe Scaler ‚Ä¢ Perfect portions every time</p>
    </footer>

    <script>
        let currentScale = 1.0;

        // Parse a number from text (handles fractions, decimals, ranges)
        function parseNumber(text) {
            // Handle fractions like "1/2"
            if (text.includes('/')) {
                const parts = text.split('/').map(p => parseFloat(p.trim()));
                if (parts.length === 2 && !isNaN(parts[0]) && !isNaN(parts[1])) {
                    return parts[0] / parts[1];
                }
            }

            // Handle ranges like "4-8" (take average)
            if (text.includes('-')) {
                const parts = text.split('-').map(p => parseFloat(p.trim()));
                if (parts.length === 2 && !isNaN(parts[0]) && !isNaN(parts[1])) {
                    return (parts[0] + parts[1]) / 2;
                }
            }

            return parseFloat(text);
        }

        // Format a number for display
        function formatNumber(num) {
            // Round to 2 decimal places
            num = Math.round(num * 100) / 100;

            // Convert to fraction if it's a common one
            const fractions = {
                0.125: '1/8', 0.25: '1/4', 0.333: '1/3', 0.5: '1/2',
                0.667: '2/3', 0.75: '3/4', 1.5: '1 1/2', 2.5: '2 1/2'
            };

            for (const [decimal, fraction] of Object.entries(fractions)) {
                if (Math.abs(num - parseFloat(decimal)) < 0.02) {
                    return fraction;
                }
            }

            // Otherwise return as decimal
            return num % 1 === 0 ? num.toString() : num.toFixed(2);
        }

        // Parse and scale an ingredient line
        function scaleIngredient(line, scale) {
            // Match patterns like "1.25 lbs ground beef" or "4 tsp honey"
            const pattern = /^([\d./\-]+(?:\s+[\d./\-]+)?)\s+(.+)$/;
            const match = line.trim().match(pattern);

            if (!match) {
                // No quantity found, return as-is
                return line;
            }

            const quantity = match[1];
            const rest = match[2];

            // Parse and scale the quantity
            const num = parseNumber(quantity);
            if (isNaN(num)) {
                return line;
            }

            const scaled = num * scale;
            const formatted = formatNumber(scaled);

            return `${formatted} ${rest}`;
        }

        // Increment scale (for stepper button)
        function incrementScale() {
            const input = document.getElementById('custom-scale');
            let currentValue = parseFloat(input.value) || currentScale || 1.0;
            let newValue = Math.round((currentValue + 0.25) * 100) / 100; // Round to 2 decimals

            if (newValue <= 10) {
                input.value = newValue;
                currentScale = newValue;
                scaleRecipe();
                if (window.hapticLight) hapticLight();

                // Clear active preset buttons
                document.querySelectorAll('.scale-button').forEach(btn => {
                    btn.classList.remove('active', 'bg-blue-500', 'text-white');
                    btn.classList.add('bg-blue-100', 'text-blue-800');
                });
            } else {
                if (window.showToast) showToast('Maximum scale is 10x');
                if (window.hapticError) hapticError();
            }
        }

        // Decrement scale (for stepper button)
        function decrementScale() {
            const input = document.getElementById('custom-scale');
            let currentValue = parseFloat(input.value) || currentScale || 1.0;
            let newValue = Math.round((currentValue - 0.25) * 100) / 100; // Round to 2 decimals

            if (newValue >= 0.1) {
                input.value = newValue;
                currentScale = newValue;
                scaleRecipe();
                if (window.hapticLight) hapticLight();

                // Clear active preset buttons
                document.querySelectorAll('.scale-button').forEach(btn => {
                    btn.classList.remove('active', 'bg-blue-500', 'text-white');
                    btn.classList.add('bg-blue-100', 'text-blue-800');
                });
            } else {
                if (window.showToast) showToast('Minimum scale is 0.1x');
                if (window.hapticError) hapticError();
            }
        }

        // Set scale factor
        function setScale(scale) {
            currentScale = scale;
            document.getElementById('custom-scale').value = '';

            // Update active button
            document.querySelectorAll('.scale-button').forEach(btn => {
                btn.classList.remove('active', 'bg-blue-500', 'text-white');
                btn.classList.add('bg-blue-100', 'text-blue-800');
            });

            const activeBtn = event.target;
            activeBtn.classList.add('active', 'bg-blue-500', 'text-white');
            activeBtn.classList.remove('bg-blue-100', 'text-blue-800');

            scaleRecipe();
        }

        // Apply custom scale
        function applyCustomScale() {
            const customScale = parseFloat(document.getElementById('custom-scale').value);
            if (!isNaN(customScale) && customScale > 0) {
                currentScale = customScale;

                // Clear active buttons
                document.querySelectorAll('.scale-button').forEach(btn => {
                    btn.classList.remove('active', 'bg-blue-500', 'text-white');
                    btn.classList.add('bg-blue-100', 'text-blue-800');
                });

                scaleRecipe();
            }
        }

        // Scale the recipe
        function scaleRecipe() {
            const ingredients = document.getElementById('ingredients-input').value;
            if (!ingredients.trim()) {
                return;
            }

            const lines = ingredients.split('\n');
            const scaled = lines.map(line => scaleIngredient(line, currentScale));

            // Update output
            const output = document.getElementById('scaled-output');
            output.innerHTML = scaled.map(line =>
                `<div class="py-1 hover:bg-slate-100 px-2 rounded">${line}</div>`
            ).join('');

            // Update servings
            const originalServings = parseInt(document.getElementById('original-servings').value) || 4;
            const newServings = Math.round(originalServings * currentScale);
            document.getElementById('new-servings').textContent = newServings;
            document.getElementById('current-scale').textContent = currentScale.toFixed(1) + 'x';
        }

        // Load sample recipe
        function loadSampleRecipe() {
            document.getElementById('recipe-name').value = 'Gochugaru Beef & Broccoli Bowl';
            document.getElementById('original-servings').value = '4';
            document.getElementById('ingredients-input').value = `1.25 lbs ground beef
8 cups broccoli florets
4 cups cooked brown rice
6 tbsp soy sauce
4-8 tsp gochugaru
4 tsp honey
4 tsp sesame oil
8 cloves garlic
4 tsp ginger`;
            scaleRecipe();
        }

        // Copy scaled recipe
        function copyScaledRecipe() {
            const recipeName = document.getElementById('recipe-name').value || 'Recipe';
            const newServings = document.getElementById('new-servings').textContent;
            const output = document.getElementById('scaled-output');

            const lines = Array.from(output.querySelectorAll('div')).map(div => div.textContent);

            const text = `${recipeName} (${newServings} servings)\n\nIngredients:\n${lines.join('\n')}`;

            navigator.clipboard.writeText(text).then(() => {
                showNotification('Recipe copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy:', err);
                alert('Failed to copy to clipboard');
            });
        }

        // Print recipe
        function printRecipe() {
            const recipeName = document.getElementById('recipe-name').value || 'Recipe';
            const newServings = document.getElementById('new-servings').textContent;
            const output = document.getElementById('scaled-output');

            const lines = Array.from(output.querySelectorAll('div')).map(div => div.textContent);

            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                <head>
                    <title>${recipeName}</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        h1 { color: #333; }
                        ul { list-style: none; padding: 0; }
                        li { padding: 5px 0; border-bottom: 1px solid #eee; }
                    </style>
                </head>
                <body>
                    <h1>${recipeName}</h1>
                    <p><strong>Servings:</strong> ${newServings}</p>
                    <h2>Ingredients</h2>
                    <ul>
                        ${lines.map(line => `<li>${line}</li>`).join('')}
                    </ul>
                </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
        }

        // Show notification
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-20 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
            notification.innerHTML = `
                <div class="flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    <span class="font-semibold">${message}</span>
                </div>
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.3s';
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        }

        // Auto-scale on input change
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('ingredients-input').addEventListener('input', scaleRecipe);
            document.getElementById('original-servings').addEventListener('input', scaleRecipe);
        });
    </script>

<!-- Dark Mode Toggle Button - Include in all pages -->
<button
    id="dark-mode-toggle"
    onclick="toggleDarkMode()"
    class="fixed top-4 right-4 z-[100] w-12 h-12 rounded-full bg-white/90 dark:bg-slate-800/90 backdrop-blur-sm shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center group border-2 border-transparent hover:border-orange-400 no-print"
    aria-label="Toggle dark mode"
    title="Toggle dark mode"
>
    <!-- Sun Icon (visible in dark mode) -->
    <svg
        class="w-6 h-6 text-yellow-500 dark-mode-icon-sun hidden"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
    >
        <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
        />
    </svg>

    <!-- Moon Icon (visible in light mode) -->
    <svg
        class="w-6 h-6 text-slate-700 dark-mode-icon-moon"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
    >
        <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
        />
    </svg>
</button>

<style>
    /* Dark mode toggle icon visibility */
    [data-theme="dark"] .dark-mode-icon-moon {
        display: none;
    }

    [data-theme="dark"] .dark-mode-icon-sun {
        display: block;
    }

    [data-theme="light"] .dark-mode-icon-sun {
        display: none;
    }

    [data-theme="light"] .dark-mode-icon-moon {
        display: block;
    }

    /* Pulse animation on first load */
    @keyframes pulse-once {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
    }

    #dark-mode-toggle.first-load {
        animation: pulse-once 0.5s ease-out;
    }

    /* Rotate animation on click */
    @keyframes rotate-icon {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    #dark-mode-toggle.rotating svg {
        animation: rotate-icon 0.5s ease-out;
    }

    /* Position adjustment for mobile bottom nav */
    @media (max-width: 767px) {
        #dark-mode-toggle {
            top: auto;
            bottom: 5rem;
            right: 1rem;
        }
    }

    /* Print mode - hide toggle */
    @media print {
        #dark-mode-toggle {
            display: none !important;
        }
    }
</style>

<script>
    // Add rotating animation on click
    document.addEventListener('DOMContentLoaded', () => {
        const toggle = document.getElementById('dark-mode-toggle');
        if (toggle) {
            toggle.addEventListener('click', () => {
                toggle.classList.add('rotating');
                setTimeout(() => {
                    toggle.classList.remove('rotating');
                }, 500);
            });

            // Pulse animation on first load to draw attention
            if (!localStorage.getItem('dark-mode-toggle-seen')) {
                setTimeout(() => {
                    toggle.classList.add('first-load');
                    setTimeout(() => {
                        toggle.classList.remove('first-load');
                        localStorage.setItem('dark-mode-toggle-seen', 'true');
                    }, 500);
                }, 1000);
            }
        }
    });
</script>

</body>
</html>
